<style media="screen">
html, body{
width: 100%;
height: 100%;
margin: 0;
padding: 0;
font-family: 'Open Sans', sans-serif;
background-color: #1f3189;
}

h1,h2,  h4, h5 ,h6{
font-weight: 200;
}
h3 { font-family: 'Enriqueta', arial, serif; line-height: 1.25; margin: 0 0 10px; font-size: 27px; font-weight: bold; }

a{
text-decoration: none;
}

p, li, a{
font-size: 14px;
}

fieldset{
margin: 0;
padding: 0;
border: none;
}

/* GRID */

.twelve { width: 100%; }
.eleven { width: 91.53%; }
.ten { width: 83.06%; }
.nine { width: 74.6%; }
.eight { width: 66.13%; }
.seven { width: 57.66%; }
.six { width: 49.2%; }
.five { width: 40.73%; }
.four { width: 32.26%; }
.three { width: 23.8%; }
.two { width: 15.33%; }
.one { width: 6.866%; }

/* COLUMNS */

.col {
display: block;
float:left;
margin: 0 0 0 1.6%;
}

.col:first-of-type {
margin-left: 0;
}

.container{
width: 100%;
max-width: 700px;
margin: 0 auto;
position: relative;
}

.row{
padding: 20px 0;
}

/* CLEARFIX */

.cf:before,
.cf:after {
  content: " ";
  display: table;
}

.cf:after {
  clear: both;
}

.cf {
  *zoom: 1;
}

.wrapper{
width: 100%;
margin: 30px 0;
}

/* STEPS */

.steps{
list-style-type: none;
margin: 0;
padding: 0;
background-color: #fff;
text-align: center;
}


.steps li{
display: inline-block;
margin: 20px;
color: #ccc;
padding-bottom: 5px;
}

.steps li.is-active{
border-bottom: 1px solid #3498db;
color: #3498db;
}

/* FORM */

.form-wrapper .section{
padding: 0px 20px 30px 20px;
-webkit-box-sizing: border-box;
-moz-box-sizing: border-box;
box-sizing: border-box;
background-color: #fff;
opacity: 0;
-webkit-transform: scale(1, 0);
-ms-transform: scale(1, 0);
-o-transform: scale(1, 0);
transform: scale(1, 0);
-webkit-transform-origin: top center;
-moz-transform-origin: top center;
-ms-transform-origin: top center;
-o-transform-origin: top center;
transform-origin: top center;
-webkit-transition: all 0.5s ease-in-out;
-o-transition: all 0.5s ease-in-out;
transition: all 0.5s ease-in-out;
text-align: center;
position: absolute;
width: 100%;
min-height: 300px
}

.form-wrapper .section h3{
margin-bottom: 30px;
}

.form-wrapper .section.is-active{
opacity: 1;
-webkit-transform: scale(1, 1);
-ms-transform: scale(1, 1);
-o-transform: scale(1, 1);
transform: scale(1, 1);
}

.form-wrapper .button, .form-wrapper .submit{
background-color: #3498db;
display: inline-block;
padding: 8px 30px;
color: #fff;
cursor: pointer;
font-size: 14px !important;
font-family: 'Open Sans', sans-serif !important;
position: absolute;
right: 20px;
bottom: 20px;
}

.form-wrapper .submit{
border: none;
outline: none;
-webkit-box-sizing: content-box;
-moz-box-sizing: content-box;
box-sizing: content-box;
-webkit-appearance: none;
-moz-appearance: none;
appearance: none;
}

.form-wrapper input[type="text"],
.form-wrapper input[type="password"]{
display: block;
padding: 10px;
margin: 10px auto;
background-color: #f1f1f1;
border: none;
width: 50%;
outline: none;
font-size: 14px !important;
font-family: 'Open Sans', sans-serif !important;
}

.form-wrapper input[type="radio"]{
display: none;
}

.form-wrapper input[type="radio"] + label{
display: block;
border: 1px solid #ccc;
width: 100%;
max-width: 100%;
padding: 10px;
-webkit-box-sizing: border-box;
-moz-box-sizing: border-box;
box-sizing: border-box;
cursor: pointer;
position: relative;
}

.form-wrapper input[type="radio"] + label:before{
content: "âœ”";
position: absolute;
right: -10px;
top: -10px;
width: 30px;
height: 30px;
line-height: 30px;
border-radius: 100%;
background-color: #3498db;
color: #fff;
display: none;
}

.form-wrapper input[type="radio"]:checked + label:before{
display: block;
}

.form-wrapper input[type="radio"] + label h4{
margin: 15px;
color: #ccc;
}

.form-wrapper input[type="radio"]:checked + label{
border: 1px solid #3498db;
}

.form-wrapper input[type="radio"]:checked + label h4{
color: #3498db;
}

/* Style the tab buttons */
.tablink {
  background-color: #555;
  color: white;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 16px;
  font-size: 17px;
  width: 33.3%;
}

/* Change background color of buttons on hover */
.tablink:hover {
  background-color: #777;
}

/* Set default styles for tab content */
.tabcontent {
  color: white;
  display: none;
  padding: 50px;
  text-align: center;
}

/* Style each tab content individually */


</style>
<title id="title"></title>
<div class="container">

  <div class="wrapper">
    <ul class="steps">
      <h3 id='description'>Poll of voting intention for an upcoming US Presidential election</h3>
      <li class="is-active">Question 1</li>
      <li>Question 2</li>
      <li>Question 3</li>
    </ul>
    <form class="form-wrapper">
      <fieldset class="section is-active">
        <h1 id="questionOne"></h1>
        <select id="states" class="js-example-basic-single" style="display: inline-block;
          width: 250px;
          margin-left: 50px;
          color: #333333;
          font-size: 16px;
          letter-spacing: 1px;" name="state">
        </select>
        <div class="button">Next</div>
      </fieldset>
      <fieldset class="section">
        <h1 id='questionTwo'></h1>
        <div class="row cf">
          <div class="six col">
            <input type="radio" name="r1" label='firstOptionQuestionTwo' id="r1" checked>
            <label for="r1">
              <h4 id="firstOptionQuestionTwo"></h4>
            </label>
          </div>
          <div class="six col">
            <input type="radio" name="r1" label='secondOptionQuestionTwo' id="r2">
            <label for="r2">
              <h4 id="secondOptionQuestionTwo"></h4>
            </label>
          </div>
        </div>
        <div class="button">Next</div>
      </fieldset>
      <fieldset class="section">
        <h1 id='questionThree'></h1>
        <div class="row cf">
          <div class="four col">
            <input type="radio" name="r3" label='firstOptionQuestionThree' id="r3" checked>
            <label for="r3">
              <h4 id="firstOptionQuestionThree"></h4>
            </label>
          </div>
          <div class="four col">
            <input type="radio" name="r3" label='secondOptionQuestionThree' id="r4">
            <label for="r4">
              <h4 id="secondOptionQuestionThree"></h4>
            </label>
          </div>
          <div class="four col">
            <input type="radio" name="r3" label='thirdOptionQuestionThree' id="r5">
            <label for="r5">
              <h4 id="thirdOptionQuestionThree"></h4>
            </label>
          </div>
        </div>
        <div class="button">Next</div>
      </fieldset>
      <fieldset class="section">
        <h3>Reply Sent!</h3>
        <p>your reply has been sent.</p>
        <div class="row">
          <button class="tablink" onclick="openCity('contry_Results', this)" id="defaultOpen">Contry Results</button>
          <button class="tablink" onclick="openCity('state_results', this)">State Result</button>
          <button class="tablink" onclick="openCity('votesIntentionResult', this)">Intention Result</button>
        </div>
          <div id="contry_Results" class="tabcontent">
            <canvas id="countryResultCanvas"></canvas>
          </div>

          <div id="state_results" class="tabcontent">
            <canvas id="stateResultCanvas"></canvas>
          </div>

          <div id="votesIntentionResult" class="tabcontent">
            <canvas id="intentionResultCanvas"></canvas>
          </div>




        <div class="button" style="margin-top:10px">Reset Poll</div>
      </fieldset>
    </form>
  </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script type="text/javascript">

$(document).ready(function(){
  var config={
    url:"http://lvh.me/",
    poll_id:1
  };
  var pollData;
  var questionData;

    $.ajax({
      type: 'GET',
      crossDomain: true,
      url: config.url+'api/getPoll/1',
      beforeSend: function( xhr ) {
        xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
      }
    }).done(function( data ) {
        data=JSON.parse(data);
        pollData=data.data.poll;
        questionData=data.data.questions;
        $('title').html(pollData.title);
        //$('#description').html(pollData.description);
        //$('h1').html(pollData.description);

        $('#questionOne').html(questionData[0].question);
        var optionsStates = questionData[0].options.split("/");
        $('#states').select2();
        optionsStates.forEach((option, i) => {
          var newOption = new Option(option, option, false, false);
          $('#states').append(newOption).trigger('change');
        });

        $('#questionTwo').html(questionData[1].question);
        var optionsWillVote = questionData[1].options.split("/");
        $('#firstOptionQuestionTwo').html(optionsWillVote[0]);
        $('#secondOptionQuestionTwo').html(optionsWillVote[1]);

        $('#questionThree').html(questionData[2].question);
        var optionsCandidate = questionData[2].options.split("/");
        $('#firstOptionQuestionThree').html(optionsCandidate[0]);
        $('#secondOptionQuestionThree').html(optionsCandidate[1]);
        $('#thirdOptionQuestionThree').html(optionsCandidate[2]);
        //console.log(questionData[0]);


      }).fail(function() {
          alert("Unknown Error Occured. Server response not received.");
      });
  $(".form-wrapper .button").click(function(){

    var button = $(this);
    var currentSection = button.parents(".section");
    var currentSectionIndex = currentSection.index();
    var headerSection = $('.steps li').eq(currentSectionIndex);
    currentSection.removeClass("is-active").next().addClass("is-active");
    headerSection.removeClass("is-active").next().addClass("is-active");

    $(".form-wrapper").submit(function(e) {
      e.preventDefault();
    });

    if(currentSectionIndex === 2){
      var pollResponse=[{
        id_question:questionData[0].id,
        response:$('#states').select2('data')[0].text
        },
        {
          id_question:questionData[1].id,
          response:$('#'+$('input[name="r1"]:checked').attr( "label" )).html()
        },
        {
          id_question:questionData[2].id,
          response:$('#'+$('input[name="r3"]:checked').attr( "label" )).html()
        }
      ];
      var response={
        poll_id:config.poll_id ,
        response:JSON.stringify(pollResponse),
        latitude:'10052',
        longitude:'12541133'
      }
      $.ajax({
        type: 'POST',
        crossDomain: true,
        url: config.url+'api/setResponsePoll',
        data:response,

        beforeSend: function( xhr ) {
          xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
        }
      }).done(function( data ) {
        $.ajax({
          type: 'GET',
          crossDomain: true,
          url: config.url+'api/getResults/'+config.poll_id,
          beforeSend: function( xhr ) {
            xhr.overrideMimeType( "text/plain; charset=x-user-defined" );
          }
        }).done(function( res ) {
          res=JSON.parse(res);
          countryResult=res.data.countryResult;
          var ctx = document.getElementById('countryResultCanvas').getContext('2d');
          var countryResultCanvas = new Chart(ctx, {
              type: 'doughnut',
              data: {
                labels: ["Jeremy Jameson", "Steve Lowenthal", "Ivana Doover"],
                datasets: [
                  {
                    label: "Population (millions)",
                    backgroundColor: ["#3e95cd","#e8c3b9","#c45850"],
                    data: [countryResult['Jeremy Jameson'],countryResult['Steve Lowenthal'],countryResult['Ivana Doover']]
                  }
                ]
              },
              options: {
                title: {
                  display: false,
                  text: 'Predicted world population (millions) in 2050'
                }
              }
          });

          stateResult=res.data.stateResult;
          var ctx = document.getElementById('stateResultCanvas').getContext('2d');
          var candidate1=[];
          var candidate2=[];
          var candidate3=[];
          Object.keys(stateResult).forEach((state, i) => {
            candidate1.push(stateResult[state]['Jeremy Jameson']);
            candidate2.push(stateResult[state]['Steve Lowenthal']);
            candidate3.push(stateResult[state]['Ivana Doover']);
          });
          var stateResultCanvas = new Chart(ctx, {
              type: 'bar',
              data: {
                labels: Object.keys(stateResult),
                datasets: [
                  {
                    label: "Jeremy Jameson",
                    backgroundColor: "#3e95cd",
                    data: candidate1
                  }, {
                    label: "Steve Lowenthal",
                    backgroundColor: "#e8c3b9",
                    data: candidate2
                  },
                  {
                    label: "Ivana Doover",
                    backgroundColor: "#c45850",
                    data: candidate3
                  }
                ]
              },
              options: {
                title: {
                  display: false,
                  text: 'Population growth (millions)'
                }
              }
          });

          intentionResult=res.data[' votesIntentionResult'];
          var ctx = document.getElementById('intentionResultCanvas').getContext('2d');
          var intentionResultCanvas = new Chart(ctx, {
              type: 'bar',
              data: {
                labels: ['vote',"Don't Vote"],
                datasets: [
                  {
                    label: "Jeremy Jameson",
                    backgroundColor: "#3e95cd",
                    data: [intentionResult['vote']['Jeremy Jameson'],intentionResult['dontVote']['Jeremy Jameson']]
                  }, {
                    label: "Steve Lowenthal",
                    backgroundColor: "#e8c3b9",
                    data: [intentionResult['vote']['Steve Lowenthal'],intentionResult['dontVote']['Steve Lowenthal']]
                  },
                  {
                    label: "Ivana Doover",
                    backgroundColor: "#c45850",
                    data: [intentionResult['vote']['Ivana Doover'],intentionResult['dontVote']['Ivana Doover']]
                  }
                ]
              },
              options: {
                title: {
                  display: false,
                  text: 'Population growth (millions)'
                }
              }
          });

        });

        }).fail(function() {
            alert("Unknown Error Occured. Server response not received.");
        });
    }

    if(currentSectionIndex === 3){
      $(document).find(".form-wrapper .section").first().addClass("is-active");
      $(document).find(".steps li").first().addClass("is-active");
    }
  });


});
document.getElementById('contry_Results').style.display = "block";
function openCity(cityName, elmnt) {
  // Hide all elements with class="tabcontent" by default */
  var i, tabcontent, tablinks;
  tabcontent = document.getElementsByClassName("tabcontent");
  for (i = 0; i < tabcontent.length; i++) {
    tabcontent[i].style.display = "none";
  }

  // Show the specific tab content
  document.getElementById(cityName).style.display = "block";


}



</script>
